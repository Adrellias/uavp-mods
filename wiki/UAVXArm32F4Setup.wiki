#summary The evolving setup page for the Arm version of UAVX.
#labels Featured,UAVXArm32F4,UAVP,Multicopter

== Introduction ==

This is the evolving setup page for the Arm version of UAVX. We will try to keep explanations concise.
 
UAVXStartup contains a wealth of information which you could take the time to read. You should pay particular attention to what different patterns of LED behaviour mean (Lights and Sirens). 

First UAVXArm32F4 supports many different airframe types from octocopters, through helis out to conventional aircraft. UAVX has done this for several years. The various configurations are shown in UAVXStartup. 

To keep it simple we will assume you are flying a quadrocopter (4 motors) in plus(+) mode where one arm points forward. 

==== UAVXArm32F4 Board ====

http://uavp-mods.googlecode.com/svn/branches/uavx_graphics/UAVXArm32F4Connections.png

=== Step 1 ===

Mount the board on your favourite frame - take the props OFF. 

The ARROW on the top of the board must point directly along the forward motor arm. 

Take all the the shorting links (if any) off the board. Connect up an arming switch between the Arming pin and the adjacent Ground pin. 

The motors should not run even if you have the arming switch on until you get through all of the following steps but think about a Kw of motors all running at around 7000RPM flying around your workshop - take the props OFF.

The board can be connected directly to your main battery (3-4S LiPo).

The Red and Yellow LEDs should be on.

=== Step 2 ===

Download the software package from the downloads area and install UAVPset and UAVXGS.

Connect the adapter lead to the board and then to a USB port on your computer.

Start UAVPSet and check that you have the appropriate COM port selected. 

In UAVPSet select Tools->TestSoftware->D (load defaults).  Close the test window and select the *Read Config* icon. The default parameter set should populate the various boxes. There are a lot of parameters most of which you may never have to adjust. If you highlight any of the parameter boxes explanatory text should be displayed in the text window.

Now use Tools->TestSoftware run the Setup Test.  Read the results and try to make sense of it. At the bottom you will see various alarms. With luck the only alarms will be that you have not calibrated the accelerometer, gyros and magnetometer and the Rx is not working.
 
=== Step 3 (Rx) ===

Important - the black or ground pins of your Rx and Motor connections should be connected to the pins closest to the edge of the board. If in doubt double check with a multimeter.

From now on any changes you make to parameters in UAVPSet must be followed by selecting the *Write Config* icon. 

Connect the front motor control lead to M1. This will power your Rx as centre pins of all of the M and Rx pins are connected together. 

If you have a a Rx (e.g. FrSky) that supports Compound PPM (CPPM) connect it to Rx1. For CPPM you must specify the number of channels your Rx is receiving using UAVPSet.

If you have an Rx that uses Parallel PPM (PPPM) then connect it to Rx1 up to Rx8 in the order Throttle, Aileron, Elevator, Rudder, Gear, Aux1, Aux2, Aux3. You need a minimum of 7 channels for full functionality.

For PPPM number of channels you have actually connected using UAVPSet. 

You can fly with a minimum of 4 channels Throttle, Aileron, Elevator, Rudder. If you do so then you will have altitude hold but no navigation capability. 

You may re-assign the channels using the selectors in UAVPSet. So if your throttle is on Channel 3 then setup the pulldowns appropriately. 

Turn on your Tx and run the Setup Test again. If you got lucky the Rx will be OK. Select Tools->TestSoftware->P (Rx Test)and it will show you what is failing. The throttle channel should be around 5%, Aileron, Elevator and Rudder about 50% and Gear around 10%. 

If the Rx Test passes then close the test software window and select the Tx/Rx setup icon. Double check the controls are behaving sensibly and the endpoints are under 100%.

In writing this an auto configure for the Rx has moved to the top of the development list but not for the first release! 

=== Step 4 (Acc/Gyro Temperature Calibration)===

This is the most critical step in the setup and you usually only need to do it once or until you next bend the aircraft.

Put the aircraft on a level surface. If it is on the slightest of angles then this is the way it will fly when you centralise the sticks. Bear in mind the floors of your house will not be level, your best table will not be level nor will your average workbench. Eyeballing it is no good at all.

Get a decent spirit level and even then turn it around to make sure it reads level both ways.

Lock the quadrocopter down so it does not move and recheck.

Power up with UAVPSet connected.  Select Tests/SoftwareTools/N (Cal Accs/Gyros). Confirm you are ready to go by selecting Continue.   You will see the blue LED start to flash - it has already taken the first set of readings.  Get a hair dryer and GENTLY/SLOWLY warm up the board. You only need to change its temperature in two steps of 10 Celsius or 20 all up so don't melt the board!  There is a delay as the heat gets into the package so slowly/slowly. The Blue LED will flash then stop  for about a second while the second set of readings are taken  then start to flash again as the temperature rises to the third measurement point. The LED will stay on  one last time then go off. 

Now use the Tools->SoftwareTests->I (acc/gyro test) to check that the Roll/Pitch/Yaw rate are close to zero. Also check the Acc values which should show Front/Back (FB) and LR close to zero and UD close to -1. Once again you only need to do this once or when loading the defaults or if you change the gyro selection pulldown - it should be on UAVXArm32 unless you are using analog gyros.

=== Step 5 (Magnetometer Calibration) ===

Run the magnetometer calibration test in UAVPSet. Rotate the aircraft in all the directions you can think of including upside down and on edge. This captures the initial maximum and minimum values of the X,Y and Z axes. You do not need to re-run the calibration unless it is clearly giving crazy answers for the computed compass heading. The maximum/minimum values are stored in non-volatile memory where they are retained after disconnecting the battery.

The maximum/minimum values are also tracked continuously when the aircraft is powered including in flight when the motors are running. Unlike the calibration test they are only written to memory when you disarm.

The compass heading estimate should gradually improve as the max/min values stabilise. 

At this point you should run the setup test and see if all of the alarms are cleared. If they are you are almost ready to fly but don't put the props on yet.

=== Step 6 (Motors) ===

Disconnect the centre leads of the rest of your ESC control leads and make sure they are taped back and insulated. 

Connect the other motors:

  * Left M2
  * Right M3
  * Back M4

Note: If you plan to run camera gimbals then it is worth considering buying a high current UBEC and connecting that to an unused Rx or M. In that case disconnect all of the BEC centre leads and connect the UBEC to an unused M/Rx connector.

Put the aircraft on the ground. Leave the props OFF and switch the arming switch on. You should hear three starting beeps.

Advance the throttle and all motors should start. Run the motors more very slowly as you can damage them if you run at high speed without props. Listening carefully move your controls and verify that if you move the aileron right that the left motor increases speed and the right motor slows down. The same for elevator. Rudder left should slow down the front/back motors and speed up the left/right motors by the same amount. 

Now lift the quarocopter up and tilt it left/right, front/back. It should be obvious what the motors will do. Tipping right should cause the right motor to speed up. Again use very little throttle.

If everything seems OK you can power down and make your own decision whether it is SAFE to fit the propellors and fly.

*THIS IS NOT A FLIGHT TUTORIAL SO FROM THIS POINT IT IS UP TO YOU.* 

  


=== Loading Firmware ===

Your board will come with the appropriate firmware loaded. To load new firmware you use the STM Flash Loader in the distribution package. Description will follow.